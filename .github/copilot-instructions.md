# Alternity Warships Generator - Copilot Instructions

## Project Overview

This is a desktop application for generating Warships for the **Alternity** sci-fi tabletop role-playing game. The app implements the ship construction rules from the "Warships" sourcebook by Richard Baker.

The application guides users through a step-by-step warship building process, similar to a character creation wizard.

## Tech Stack

- **Frontend**: React 18 + TypeScript
- **UI Framework**: Material-UI (MUI) v6
- **Build Tool**: Vite
- **Desktop**: Electron (with context isolation enabled)
- **Package Manager**: npm

## Project Structure

```
src/
├── components/       # React components for each build step
│   ├── WelcomePage.tsx
│   ├── HullSelection.tsx
│   ├── ArmorSelection.tsx
│   ├── PowerPlantSelection.tsx
│   └── EngineSelection.tsx
├── services/         # Business logic and calculations
│   ├── dataLoader.ts      # Runtime data loading (externally editable)
│   ├── hullService.ts
│   ├── armorService.ts
│   ├── powerPlantService.ts
│   ├── engineService.ts
│   └── saveService.ts
├── types/            # TypeScript type definitions
│   ├── hull.ts
│   ├── armor.ts
│   ├── powerPlant.ts
│   ├── engine.ts
│   ├── saveFile.ts
│   └── common.ts
├── data/             # JSON data files (externally editable in production)
│   ├── hulls.json
│   ├── armor.json
│   ├── powerPlants.json
│   └── engines.json
└── App.tsx           # Main app with stepper/wizard flow

electron/
├── main.ts           # Electron main process
└── preload.ts        # IPC bridge for renderer
```

## Architecture Patterns

### Data Flow
- **JSON data files** → **dataLoader.ts** (runtime load) → **Services** (calculate) → **Components** (display)
- Data files are loaded at app startup via Electron IPC, allowing users to edit them externally
- State is managed in `App.tsx` and passed down to step components
- Save/Load uses Electron IPC for native file dialogs

### Externally Editable Data Files
The game data (hulls, armor, power plants, etc.) is stored in JSON files that can be edited by users:
- In **development**: Files are read from `src/data/`
- In **production**: Files are copied to `resources/data/` alongside the app
- The `dataLoader.ts` service handles loading with fallback to bundled data
- Users can modify these files to add custom hulls, adjust costs, etc.
- Changes require app restart to take effect

### Warship Building Steps (in order)
1. **Hull** - Select ship class and hull type (required)
2. **Armor** - Choose armor weight and type (optional)
3. **Power Plant** - Install power plants for energy (required)
4. **Engines** - Install engines for movement (required)
5. **FTL Drive** - Faster-than-light capability (optional, not yet implemented)
6. **Systems** - Additional ship systems (optional, not yet implemented)

### Key Concepts from Alternity Warships
- **Hull Points (HP)**: Space available for installations; each component uses HP
- **Power Points (PP)**: Energy generated by power plants; systems consume PP
- **Ship Classes**: small-craft, light, medium, heavy, super-heavy
- **Damage Track**: stun → wound → mortal → critical
- **Toughness Rating**: Determines weapon effectiveness against the ship

## Coding Conventions

- Use TypeScript strict mode
- Prefer functional React components with hooks
- Use MUI components for consistent UI
- Keep calculations in service files, not components
- All game data comes from JSON files in `src/data/`
- Type definitions mirror the Warships rulebook terminology
- **Defensive array access**: Always use `|| []` when accessing arrays that might be undefined/null (e.g., from save files, loaded state, or optional properties). This prevents crashes from older save files, corrupted data, or missing properties. Apply consistently to all similar array access patterns (e.g., `state.powerPlants || []`, `state.engines || []`).

## UI Conventions

- **Maximize screen usage**: UI should expand to fill all available screen space
- **Tables/Grids**: Should take all the horizontal space they need - avoid wrapping content awkwardly
- **Single horizontal scrollbar**: When content overflows, use ONE horizontal scrollbar at the container level, not multiple nested scrollbars
- **Responsive but desktop-first**: This is an Electron desktop app, so optimize for larger screens
- **Action columns first**: In data tables with action buttons (Add, Edit, Delete), place the Action column at the beginning (leftmost) so users don't need to scroll to access it

## Data Format Conventions

### Tech Tracks
Technology tracks are represented as arrays in all data files (hulls, armor, power plants, engines):
- **Empty array `[]`**: No special technology required
- **Single tech `["G"]`**: Requires one technology track (e.g., Gravity Manipulation)
- **Multiple techs `["P", "X"]`**: Requires multiple technology tracks

Available tech track codes:
- `G` - Gravity Manipulation
- `D` - Dark Matter Tech
- `A` - Antimatter Tech
- `M` - Matter Coding
- `F` - Fusion Tech
- `Q` - Quantum Manipulation
- `T` - Matter Transmission
- `S` - Super-Materials
- `P` - Psi-tech
- `X` - Energy Transformation
- `C` - Computer Tech

## Development Commands

```bash
npm run dev:electron    # Run in development mode
npm run build:electron  # Build for production
npm run dist:win        # Create Windows installer
```

## Current State / TODO

### Implemented
- [x] Hull selection with stats display
- [x] Armor selection (weight + type)
- [x] Power plant installation (multiple plants, fuel tanks)
- [x] Engine installation (multiple engines, fuel tanks, acceleration calculations)
- [x] Save/Load warship to .warship.json files
- [x] Electron menu with keyboard shortcuts
- [x] Externally editable data files (loaded at runtime)

### Not Yet Implemented
- [ ] FTL Drive step
- [ ] Systems step (weapons, defenses, sensors, etc.)
- [ ] Final summary/export step
- [ ] Validation for minimum requirements

## Reference Material

The `Warships.txt` file in the project root contains the full text of the Alternity Warships sourcebook. Use this as the authoritative reference for:
- Ship construction rules (Chapter 5)
- Hull types and their stats
- Equipment costs and requirements
- Game mechanics and terminology

---

*Last updated: January 2026*
